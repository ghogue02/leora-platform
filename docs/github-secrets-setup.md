# GitHub Secrets Setup Guide

## üîí Required Secrets for CI/CD

Configure these secrets in your GitHub repository settings:
**Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret**

---

## Development Environment Secrets

### **Vercel Integration**
```
VERCEL_TOKEN         - Vercel deployment token
VERCEL_ORG_ID        - Your Vercel organization ID
VERCEL_PROJECT_ID    - Your Vercel project ID
```

**How to get these:**
1. Go to https://vercel.com/account/tokens
2. Create a new token with deployment scope
3. Run `vercel link` in your project to get ORG_ID and PROJECT_ID

---

### **Database (Supabase)**
```
DATABASE_URL         - PostgreSQL connection string (for preview/dev)
DIRECT_URL           - Direct PostgreSQL connection (pooler bypass)
```

**Format:**
```
DATABASE_URL=postgresql://postgres.[project-ref]:[password]@aws-0-us-east-1.pooler.supabase.com:6543/postgres?pgbouncer=true
DIRECT_URL=postgresql://postgres.[project-ref]:[password]@aws-0-us-east-1.compute.amazonaws.com:5432/postgres
```

**Where to find:**
- Supabase Dashboard ‚Üí Project Settings ‚Üí Database ‚Üí Connection String
- Use "URI" for DATABASE_URL
- Use "Direct Connection" for DIRECT_URL

---

### **Authentication**
```
JWT_SECRET           - Secret key for JWT token signing (32+ random chars)
```

**Generate a secure JWT secret:**
```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

---

### **Application Configuration**
```
NEXT_PUBLIC_APP_URL  - Your app's public URL (optional for preview)
```

**Examples:**
- Production: `https://leora.com`
- Staging: `https://leora-staging.vercel.app`
- Preview: Auto-generated by Vercel

---

## Staging Environment Secrets (Optional)

If you have a separate staging environment:

```
STAGING_DATABASE_URL     - Staging database connection
STAGING_DIRECT_URL       - Staging direct connection
STAGING_JWT_SECRET       - Staging-specific JWT secret
```

---

## Production Environment Secrets (Add Later)

When ready for production, add:

```
OPENAI_API_KEY           - For "Ask Leora" AI features
PRODUCTION_DATABASE_URL  - Production database (separate from dev)
PRODUCTION_DIRECT_URL    - Production direct connection
PRODUCTION_JWT_SECRET    - Production JWT secret
```

---

## üõ°Ô∏è Security Best Practices

### ‚úÖ **DO:**
- ‚úÖ Use different secrets for dev/staging/production
- ‚úÖ Rotate secrets regularly (every 90 days)
- ‚úÖ Use GitHub environment protection rules for production
- ‚úÖ Keep secrets in GitHub Secrets, never commit them
- ‚úÖ Use read-only database users for CI/CD when possible
- ‚úÖ Enable "Require approval for deployments" in production environment

### ‚ùå **DON'T:**
- ‚ùå Never commit `.env` files with real secrets
- ‚ùå Never log secrets in GitHub Actions output
- ‚ùå Never use production secrets in development
- ‚ùå Never share secrets in Slack/Discord/email
- ‚ùå Never reuse secrets across different services

---

## üîß Testing Your Secrets Locally

Create `.env.local` (gitignored) for local development:

```bash
# Copy from .env.example
cp .env.example .env.local

# Add your actual values
DATABASE_URL=postgresql://postgres:password@localhost:5432/leora_dev
DIRECT_URL=postgresql://postgres:password@localhost:5432/leora_dev
JWT_SECRET=your-local-dev-secret-min-32-chars
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

**Verify secrets work:**
```bash
npm run build  # Should succeed if secrets are correct
npx prisma db push  # Should connect to database
```

---

## üìã Quick Setup Checklist

- [ ] Create Vercel account and project
- [ ] Run `vercel link` to get ORG_ID and PROJECT_ID
- [ ] Generate Vercel token at https://vercel.com/account/tokens
- [ ] Create Supabase project
- [ ] Get DATABASE_URL and DIRECT_URL from Supabase
- [ ] Generate JWT_SECRET using Node.js crypto
- [ ] Add all secrets to GitHub repository settings
- [ ] Test by creating a PR (should trigger preview deployment)
- [ ] Verify preview deployment works
- [ ] Set up environment protection for staging/production

---

## üö® Secret Compromise Response

If a secret is exposed:

1. **Immediately rotate the secret:**
   - Vercel: Regenerate token
   - Database: Reset password in Supabase
   - JWT: Generate new secret

2. **Update GitHub Secrets** with new values

3. **Re-deploy** all environments

4. **Audit logs** for unauthorized access

5. **Review recent commits** for the exposure source

---

## üìû Support

- **Vercel Docs:** https://vercel.com/docs/concepts/projects/environment-variables
- **Supabase Docs:** https://supabase.com/docs/guides/database/connecting-to-postgres
- **GitHub Secrets:** https://docs.github.com/en/actions/security-guides/encrypted-secrets
